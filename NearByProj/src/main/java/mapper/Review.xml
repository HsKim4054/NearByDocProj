<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.review">

	<select id="reviewListByHos" parameterType="String"
		resultType="hashmap">
	<![CDATA[
		select 	p.pname as name, 
				r.content as content,
				r.star as star, 
				r.birth as birth
		from review r, patient p 
		where r.comnum=#{comnum} AND r.pidnum=p.pidnum
	]]>
	</select>

	<insert id="insertReview" parameterType="Review">
	<![CDATA[
	insert into review (pidnum,comnum,content,star,birth) 
	values (#{pidnum},#{comnum},#{content},#{star},now()) 
	]]>
	</insert>
	
	<select id="selectLastReview" parameterType="String"
		resultType="hashmap">
	<![CDATA[
		select 	p.pname, 
				r.content,
				r.star,
				r.birth
		from review r
		JOIN patient p 
		on r.pidnum=p.pidnum
		where r.comnum=#{comnum}  AND r.birth = (SELECT MAX(birth) from review r
		JOIN patient p 
		on r.pidnum=p.pidnum
		where r.comnum=#{comnum})
	]]>
	</select>
	
</mapper>