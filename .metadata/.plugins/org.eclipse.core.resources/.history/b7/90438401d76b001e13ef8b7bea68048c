<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.reservation">
	<insert id="insertReservation" parameterType="Reservation"
		useGeneratedKeys="true" keyProperty="id">
    <![CDATA[
       insert into Reservation (pidnum,comnum,resdate,restime,comment,status,doccomment, fidnum) values 
       (#{pidnum},#{comnum},#{resdate},#{restime},#{comment},#{status},#{doccomment},#{fidnum}) 
    ]]>
	</insert>

	<select id="cntMyReservation" parameterType="String" resultType="Integer">
	<![CDATA[
		SELECT COUNT(p.pidnum)
		FROM reservation r,
		hospital h,
		patient p
		WHERE 1=1
		AND r.pidnum = #{pidnum}
		AND r.comnum = h.comnum
		]]>
	</select>


	<select id='selectMyReservation' parameterType="String" resultType="hashmap">
   <![CDATA[
   select h.hname as name
        , h.hroad as address
        , h.htel as tel
        , r.resdate as date
        , r.restime as time
        , r.`status` as status
        , r.id as id
        , r.fidnum as fidnum
    from reservation r
       , hospital h
   where 1=1
     and r.pidnum = #{pidnum}
     and r.comnum = h.comnum
order by r.resdate desc
     ]]>
	</select>
	<select id='selectTodayReservationList' parameterType="Integer" resultType="Reservation">
	<![CDATA[
		select id,resdate,restime,p.pname,p.pidnum,comment,h.department,status
		from reservation r,patient p,hospital h
		where r.pidnum=p,pidnum
		and h.comnum=r.comnum
		order by id desc
		limit #{row},10
	]]>
	</select>
	<select id='selectReservation' parameterType="Integer" resultType="Reservation">
	<![CDATA[
		select * from reservation where id=#{id}
	]]>
	</select>
	
	

	<select id='searchHRecordList' parameterType="hashmap" resultType="Reservation">
	<![CDATA[
		select * from reservation
   		where ${type} like '%${keyword}%' order by id 
   		limit #{row},10
	]]>
	
	</select>
	
	<select id='searchHRecordCount' parameterType="hashmap" resultType="Integer">
	<![CDATA[
		select count(*) from reservation
   		where ${type} like '%${keyword}%' 
	]]>
	
	</select>
	
	





</mapper>